sudo: required
dist: precise
language: cpp
branches:
  except:
  - dev-win
matrix:
  include:
  - compiler: gcc
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - g++-5
        env: COMPILER=g++-5
before_install:
- sudo apt-get -qq update
- sudo apt-get install -y gyp
script:
- git clone https://chromium.googlesource.com/external/gyp.git gyp
- python version.py
- cd test
- python ../gyp/gyp_main.py mgtest.gyp --depth=. -Duv_library=static_library "-Dtarget_arch=x64" -I../deps/libuv/common.gypi
- make CXX=/usr/bin/g++-5 CXX.host=/usr/bin/g++-5 CXX.target=/usr/bin/g++-5
- ldd out/Release/mg
- env srcdir="$(pwd)" out/Release/mgtest
- ./test_dash.py
- ./test_hls.py
after_script:
- bash -c ./boxupload.sh
deploy:
  provider: releases
  api_key:
    secure: "g6a6Z5/NHxSrUtcQix/Vbr3A5BYV2YOujOCgWuqyE5RFUBMJnA50Mx44pEa9v55mPG2paZl98J9VwmmgM8+Mwqyaza1Ny2LKMPEgHdKoQleFs+POSti/cCOJyXkKGVpott3dSOoIxPNItYYVLuDnD7eANo4tgQJzsG2PMEOzf/1grmZdfQpiiwEoxmCmrHgYqAHQQxU14ZqSTNLE2zMfm6ner9UA4PCtgJrOOr5HDiw4G3a9TGIkTc5q/X8LPzIIFWtr2Rwj5/IhU3lT/yIDiKX4gxFn42Q5PdJlJRM9Duyu3XmkpoDcalplHbSo/JuxoSa2PBTv5ICl/C3cKBGvxInZcwaYzLgm5cB7oQH3U1j+FvCw3bbaR/QfHKR35j1TJa+vWsFLeEJHZcJfNBaFjkI/tntkxk4ThH5jW/Kb+ljvIozs57d3U5TGzz0aKggldDBIDFIT5ul0ZTEcrsvia9HbkISQGdXVbrq68X1+BVNfkhX5B2w11+BLjEsyM+6fTfyp0k42DXoZeTNZTee6Uc4fbN7cHMtsMx/ESC2/ncNINLrcCbl3egrDh3ZMVH499xMW07XAtAW8yWE0T0nL6ZUGBgRP7O5qsA1iX++gjSsglxMDYZSAmvuSLS4t7DQh20wCuTW2tasNkdZVXi+5SgBtHAXADXaRmgZjzVn1iFY="
  file: out/Release/mg
  skip_cleanup: true
  on:
    repo: mediagoom/mg
    branch: master
    tags: true

